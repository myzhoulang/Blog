{"pages":[],"posts":[{"title":"centos 7.6 ä¸‹å®‰è£…Dockerå’Œå¯åŠ¨é…ç½®","text":"å®‰è£…ç¯å¢ƒ Linux ç³»ç»Ÿå†…æ ¸ 3.10 (ä½¿ç”¨ uname -ræŸ¥çœ‹) curl æ–‡ä»¶ä¼ è¾“å·¥å…· ï¼ˆæ²¡æœ‰ curl å¯ä½¿ç”¨ yum -y install curlï¼‰ æ­¥éª¤ ä½¿ç”¨curl -sSL https://get.docker.com/ | shå®‰è£…docker ä½¿ç”¨docker -væŸ¥çœ‹dockerç‰ˆæœ¬ã€‚ è®¾ç½®å›½å†…é•œåƒæºã€‚ä¿®æ”¹ /etc/docker/daemon.jsonã€‚å¦‚æœæ²¡æœ‰è¿™ä¸ªæ–‡ä»¶ï¼Œå°±åˆ›å»ºä¸€ä¸ªã€‚ 1234# vi /etc/docker/daemon.json{ &quot;registry-mirrors&quot;: [&quot;http://hub-mirror.c.163.com&quot;]} ä½¿ç”¨systemctl start dockerå¯åŠ¨dockerã€‚ ä½¿ç”¨ systemctl enable dockerå°†dockeråŠ å…¥å¼€å¯å¯åŠ¨ã€‚ å®‰è£… docker-compose ä½¿ç”¨sudo curl -L &quot;https://github.com/docker/compose/releases/download/1.24.0/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-composeå®‰è£…docker-composeã€‚ ä½¿ç”¨sudo chmod +x /usr/local/bin/docker-composeå¯¹äºŒè¿›åˆ¶æ–‡ä»¶åº”ç”¨å¯æ‰§è¡Œæƒé™ã€‚ Docker å­¦ä¹  Docker å®˜ç½‘ Docker æ–‡æ¡£ Docker å®˜æ–¹é•œåƒåº“","link":"/blog/2019/11/12/Centos%207.6%E4%B8%8B%E5%AE%89%E8%A3%85Docker%E5%92%8C%E5%90%AF%E5%8A%A8%E9%85%8D%E7%BD%AE/"},{"title":"DockerfileæŒ‡ä»¤","text":"Dockerfile ç”±ä¸€è¡Œè¡Œå‘½ä»¤è¯­å¥ç»„æˆï¼Œæ³¨é‡Šä»¥ #å¼€å¤´ã€‚Dockerfile åˆ†ä¸º 4 éƒ¨åˆ†ï¼šåŸºç¡€é•œåƒï¼Œç»´æŠ¤è€…ä¿¡æ¯ï¼Œé•œåƒæ“ä½œæŒ‡ä»¤ï¼Œå®¹å™¨å¯åŠ¨æ—¶æ‰§è¡Œçš„æŒ‡ä»¤ã€‚æ¯æ‰§è¡Œä¸€ä¸ªæŒ‡ä»¤ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªé•œåƒå±‚å¹¶å¯¹é•œåƒè¿›è¡Œæäº¤ã€‚å¯¼è‡´æ„å»ºçš„é•œåƒè‡ƒè‚¿ã€‚ æŒ‡ä»¤ FROM FROM æ˜¯éœ€è¦åŸºäºåŸºç¡€çš„é•œåƒã€‚FROMæ˜¯å¿…é¡»çš„å¹¶ä¸”å¿…é¡»æ˜¯ç¬¬ä¸€æ¡æŒ‡ä»¤ã€‚æ¨èä½¿ç”¨å®˜æ–¹çš„é•œåƒã€‚ æ ¼å¼ 123# æ²¡æœ‰`tag`é»˜è®¤æ˜¯`latest`ã€‚FROM &lt;image&gt;FROM &lt;image&gt;:&lt;tag&gt; æ¡ˆä¾‹ 1FROM ubuntu:18.04 RUN RUNæ˜¯ç”¨æ¥æ‰§è¡Œå‘½ä»¤è¡Œå‘½ä»¤çš„ã€‚RUNæŒ‡ä»¤æœ‰ä¸¤ç§æ ¼å¼ã€‚ç”±äºæ¯ä¸€æ¬¡æ‰§è¡Œéƒ½ä¼šæ·»åŠ ä¸€ä¸ªå±‚ï¼Œä¸ºäº†å‡å°‘å±‚ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ª RUN æ‰§è¡Œå¤šä¸ªå‘½ä»¤ã€‚å¤šä¸ªå‘½ä»¤ä¹‹é—´ä½¿ç”¨&amp;&amp;åˆ†å‰²ã€‚ä¸ºäº†å¯è¯»æ€§ï¼Œå¯ä»¥å°†æ¯ä¸€ä¸ªå‘½ä»¤æ¢è¡Œï¼Œæ¯ä¸€è¡Œåé¢åŠ ä¸Šæ¢è¡Œç¬¦ï¼ˆ\\ï¼‰å³å¯ã€‚æœ‰æ—¶å€™æ„å»ºéœ€è¦ä¸€äº›é¢å¤–çš„èµ„æºï¼Œè¿™äº›èµ„æºå¹¶ä¸ä¼šè¢«åˆ é™¤ï¼Œä¼šä¸€ç›´è·Ÿç€é•œåƒã€‚å¯¼è‡´é•œåƒå¾ˆå¤§ã€‚ä¸ºå‡å°‘é•œåƒå¤§å°ï¼Œå¯åœ¨æœ€ååˆ é™¤æ‰è¿™äº›æ— å…³çš„æ–‡ä»¶ï¼Œåªä¿ç•™æ­£åœ¨éœ€è¦çš„ä¸œè¥¿ã€‚ æ ¼å¼ 12RUN wget -O - https://some.site | wc -l &gt; /numberRUN [&quot;å¯æ‰§è¡Œæ–‡ä»¶&quot;, &quot;å‚æ•°1&quot;, &quot;å‚æ•°2&quot;] æ¡ˆä¾‹ 1RUN mkdir -p app &amp;&amp; apt-get update &amp;&amp; npm install CMD CMDæŒ‡ä»¤ç”¨äºæŒ‡å®šå®¹å™¨å¯åŠ¨æ—¶éœ€è¦è¿è¡Œçš„å‘½ä»¤ã€‚ æ ¼å¼ 1CMD [&quot;å¯æ‰§è¡Œæ–‡ä»¶&quot;, &quot;å‚æ•°1&quot;, &quot;å‚æ•°2&quot;] æ¡ˆä¾‹ 1CMD ['npm', 'app'] æ³¨æ„ï¼šä½¿ç”¨docker runå‘½ä»¤å¯ä»¥è¦†ç›– CMD æŒ‡ä»¤ ï¼Œå‡è®¾Dockerfile ä¸­çš„ CMDä¸ºCMD [&quot;npm&quot;, 'app'], å½“æ‰§è¡Œ docker run -it app /bin/bashçš„æ—¶å€™ï¼Œå¹¶ä¸ä¼šæ‰§è¡Œ npm app è€Œæ˜¯æ‰§è¡Œ /bin/bashã€‚ EXPOSE EXPOSEæŒ‡ä»¤å‘Šè¯‰ Docker è¯¥å®¹å™¨å†…çš„åº”ç”¨ç¨‹åºå°†ä¼šä½¿ç”¨å®¹å™¨çš„æŒ‡å®šç«¯å£ã€‚å¯ä»¥ä½¿ç”¨å¤šä¸ªEXPOSEæŒ‡ä»¤å‘å¤–éƒ¨å…¬å¼€å¤šä¸ªç«¯å£ã€‚ æ ¼å¼ 1EXPOSE &lt;port&gt; æ¡ˆä¾‹ 1EXPOSE 3000 ENV ENVæŒ‡ä»¤ç”¨æ¥åœ¨é•œåƒæ„å»ºè¿‡ç¨‹ä¸­è®¾ç½®ç¯å¢ƒå˜é‡ã€‚è¿™äº›ç¯å¢ƒå˜é‡ä¹Ÿä¼šè¢«æŒä¹…ä¿å­˜åˆ°åˆ›å»ºçš„å®¹å™¨ä¸­ã€‚å¯ä»¥é€šè¿‡docker run -e &quot;NODE_ENV=test&quot;ä¼ é€’ç¯å¢ƒå˜é‡ã€‚ æ ¼å¼ 1ENV &lt;key&gt; &lt;value&gt; æ¡ˆä¾‹ 1ENV NODE_ENV test ADD ADDæŒ‡ä»¤ä¸COPYæ ¼å¼å’Œæ€§è´¨åŸºæœ¬ä¸€è‡´ã€‚ADDçš„æºè·¯å¾„å¯ä»¥æ˜¯ä¸€ä¸ªURLã€‚å°½å¯èƒ½ä½¿ç”¨ copyã€‚åªæœ‰å½“ COPYè¾¾ä¸åˆ°è¦æ±‚çš„æ—¶å€™æ‰ä½¿ç”¨ã€‚ç±»å¦‚æºè·¯å¾„æ˜¯è¿œç¨‹çš„é“¾æ¥åœ°å€ã€‚ COPY COPYæŒ‡ä»¤å°†ä»æ„å»ºä¸Šä¸‹æ–‡ç›®å½•ä¸­çš„æ–‡ä»¶å¤åˆ¶åˆ°æ–°çš„ä¸€å±‚é•œåƒå†…çš„ä½ç½®ã€‚æ ¼å¼ï¼š 1COPY &lt;åŸè·¯å¾„&gt; &lt;ç›®æ ‡è·¯å¾„&gt; æ¡ˆä¾‹ 1COPY package*.json /app/ ENTRYPOINT ENTRYPOINTæŒ‡ä»¤å’ŒCOPYç±»ä¼¼ã€‚åŒºåˆ«åœ¨äºENTRYPOINTä¸ä¼šåœ¨å®¹å™¨å¯åŠ¨æ—¶è¢«è¦†ç›–ã€‚docker runå‘½ä»¤è¡Œä¸­æŒ‡å®šçš„å‚æ•°éƒ½ä¼šè¢«å½“åšå‚æ•°ä¼ é€’ç»™ ENTRYPOINTã€‚ VOLUME VOLUMEæŒ‡ä»¤ç”¨æ¥åˆ›å»ºä¸€ä¸ªå¯ä»¥ä»æœ¬åœ°æˆ–å…¶ä»–å®¹å™¨æŒ‚è½½çš„æŒ‚è½½ç‚¹ï¼Œç”¨äºæ•°æ®æŒä¹…åŒ–ã€‚ æ ¼å¼ 1VOLUME [ä¸»æœºç›®å½•] æ¡ˆä¾‹ 1VOLUME ['/data', '/logs'] USER USERæŒ‡ä»¤æŒ‡å®šé•œåƒä¼šä»¥ä»€ä¹ˆæ ·çš„ç”¨æˆ·å»è¿è¡Œã€‚å¯ä»¥é€šè¿‡docker run -u nginxè¦†ç›–è¯¥æŒ‡ä»¤ã€‚ä¸æŒ‡å®šå°†ä¼šä»¥rootç”¨æˆ·è¿è¡Œã€‚ æ ¼å¼ 1USER &lt;ç”¨æˆ·&gt; æ¡ˆä¾‹ 1USER nginx WORKDIR WORKDIRæŒ‡ä»¤æ˜¯åœ¨ä»è¯¥é•œåƒåˆ›å»ºå®¹å™¨æ—¶ã€‚åœ¨å®¹å™¨å†…éƒ¨åˆ›å»ºä¸€ä¸ªå·¥ä½œç›®å½•ï¼ŒENTRYPOINTå’ŒCMD æŒ‡å®šçš„ç¨‹åºä¼šåœ¨è¿™ä¸ªç›®å½•ä¸‹æ‰§è¡Œã€‚åœ¨docker runæ—¶å€™å¯ä»¥ä½¿ç”¨-wè¦†ç›–å·¥ä½œå½•ã€‚WORKDIRæŒ‡ä»¤å¯ä»¥ä¸º Dockerfileä¸­å…¶ä»–æŒ‡ä»¤è®¾ç½®å·¥ä½œç›®å½•ã€‚ æ ¼å¼ 1WORKDIR &lt;path&gt; æ¡ˆä¾‹ 1WORKDIR /usr/src/api ONBUILD ONBUILDæŒ‡ä»¤å¼å½“ä»¥å½“å‰é•œåƒä¸ºåŸºç¡€é•œåƒï¼Œå»æ„å»ºä¸‹ä¸€çº§é•œåƒçš„æ—¶å€™è¢«æ‰§è¡Œã€‚ æ ¼å¼ 1ONBUILD &lt;å…¶ä»–æŒ‡ä»¤&gt; æ¡ˆä¾‹ 1ONBUILD COPY ./package.json /app MANITAINERMANITAINERæŒ‡ä»¤æŒ‡å®šè¯¥é•œåƒçš„ä½œè€…ä¿¡æ¯ã€‚å§“åå’Œè”ç³»æ–¹å¼ æ ¼å¼ 1MANITAINER &lt;å§“å&gt; &lt;è”ç³»æ–¹å¼&gt; æ¡ˆä¾‹ 1MANITAINER James &quot;james@example.com&quot; LABEL LABELæŒ‡ä»¤ç”¨äºä¸ºè¯¥é•œåƒæ·»åŠ ä¸€äº›å…ƒæ•°æ®ï¼Œå…ƒæ•°æ®ä»¥é”®å€¼å¯¹çš„å½¢å¼å±•ç¤ºã€‚ æ ¼å¼ 12LABEL &lt;key=value&gt; &lt;key1=value1&gt;... æ¡ˆä¾‹ 1LABEL location=&quot;New Youk&quot; type=&quot;Data Center&quot;","link":"/blog/2019/11/12/Dockerfile%E6%8C%87%E4%BB%A4/"},{"title":"TypeScriptåŸºç¡€ç±»å‹.md","text":"åŸºç¡€ç±»å‹ number(æ•°å­—)numberåŒ…å«æ•´æ•°å’Œå°æ•°ã€‚å¯ä»¥æœ‰äºŒçº§åˆ¶ï¼Œå…«è¿›åˆ¶ï¼Œåè¿›åˆ¶,åå…­è¿›åˆ¶è¡¨ç¤ºæ³•ã€‚ 1234let num: number = 6; // åè¿›åˆ¶let num: number = 0xf00d; // åå…­è¿›åˆ¶let num: number = 0b1010; // äºŒè¿›åˆ¶let num: number = 0o744 // å…«è¿›åˆ¶ string(å­—ç¬¦ä¸²)stringç±»å‹ä½¿ç”¨&quot;ï¼Œ'ï¼Œ(`)è¡¨ç¤ºã€‚ 123let str: string = &quot;string&quot;;let str: string = 'string';let str: string = `string${foo}`; boolean(å¸ƒå°”)booleançš„å€¼åªæœ‰ true å’Œ falseã€‚ 1234let checked: boolean = true;let checked: boolean = false;let checked: boolean = Boolean(true);let checked: boolean = Boolean(false); array(æ•°ç»„)arrayç±»å‹åœ¨tsä¸­æœ‰ä¸¤ç§è¡¨ç¤ºæ–¹æ³•ã€‚ç±»å‹å®šä¹‰ä¸€ç§ä½¿ç”¨æ•°æ®ç±»å‹[],å¦ä¸€ç§ä½¿ç”¨Array&lt;æ•°æ®ç±»å‹&gt;ã€‚å¦‚æœéœ€è¦åœ¨ä¸€ä¸ªæ•°ç»„ä¸­æœ‰å¤šç§ä¸åŒç±»å‹çš„å¯ä»¥ç»“åˆè”åˆç±»å‹å®šä¹‰ã€‚ 12let arr:number[] = [1,2,3,4];let arr:Array&lt;number&gt; = [1,2,3,4] tuple(å…ƒç»„)tupleç±»å‹æ˜¯tsä¸­æ–°å¢çš„ã€‚è¡¨ç¤ºä¸€ä¸ªå·²çŸ¥å…ƒç´ æ•°é‡å’Œç±»å‹çš„æ•°ç»„ã€‚å¹¶ä¸”å€¼éœ€è¦å’Œç±»å‹çš„é¡ºåºä¿å­˜ä¸€è‡´ã€‚âš¡ï¸ï¼šå…ƒç»„å’Œæ•°ç»„ä¹‹é—´çš„åŒºåˆ«åœ¨äº: å…ƒç»„æ›´ä¸¥æ ¼ï¼Œå…ƒç´ çš„æ•°é‡ï¼Œç±»å‹, é¡ºåº,éƒ½éœ€è¦ä¿æŒä¸€è‡´ã€‚ 12345let t:[string, number] = [&quot;abc&quot;, 1];// âŒ æ¡ˆä¾‹ let t:[string, number] = [1, &quot;abc&quot;]; // å€¼å’Œç±»å‹çš„å®šä¹‰é¡ºåºä¸å¯¹let t:[string, number] = [&quot;1bc&quot;, 1, 2]; // å…ƒç´ å¾—æ•°é‡ä¸åŒ¹é… enum(æšä¸¾)enumç±»å‹ä¹Ÿæ˜¯tsä¸­æ–°å¢çš„ã€‚ä½¿ç”¨æšä¸¾ç±»å‹å¯ä»¥ä¸ºä¸€ç»„æ•°å€¼èµ‹äºˆå‹å¥½çš„åå­—ã€‚è¡¨ç¤ºä¸€ä¸ªå¯ä»¥é€šè¿‡keyå–åˆ°value,ä¹Ÿå¯ä»¥é€šè¿‡valueå–åˆ°keyçš„å¯¹è±¡ã€‚ 1234567891011// å®šä¹‰const Colors = { RED, BLUE, YELLOW}// ä½¿ç”¨const c: Colors = Colors.RED; // 0const c: Colors = Colors.BLUE; // 1const c: string = Colors[0]; // RED anyanyç±»å‹è¡¨ç¤ºå˜é‡å¯ä»¥æ˜¯ä»»æ„ç±»å‹ã€‚tsä¸ä¼šå»å¯¹è¿™ä¸ªå˜é‡åšç±»å‹æ£€æµ‹ã€‚ 12345let foo: any = 4;foo = 'string';foo = true;let arr: any[] = [1,'a', true]; voidvoidè¡¨ç¤ºæ²¡æœ‰ä»»ä½•ç±»å‹ã€‚å®ƒçš„å€¼åªèƒ½æ˜¯ undefinedæˆ–nullã€‚ 123456function fn():void{ console.log(1);}let foo: void = null;let foo: void = undefined; nullå’Œundefinednullå’Œundefinedæ˜¯å…¶ä»–æ‰€æœ‰ç±»å‹çš„å­ç±»å‹ã€‚âš¡ï¸ï¼šnullå€¼å’Œundefinedå€¼å¯ä»¥èµ‹ç»™å…¶ä»–ä»»ä½•ç±»å‹ã€‚å½“è®¾ç½®strictNullChecksçš„æ—¶å€™ï¼Œåªèƒ½èµ‹ç»™å®ƒä»¬è‡ªå·±å’Œvoidã€‚ 12let u:undefined = undefined;let n: null = null; neverneverè¡¨ç¤ºæ°¸è¿œä¸å­˜åœ¨çš„å€¼çš„ç±»å‹ï¼Œå¸¸ç”¨äºæŠ›å‡ºé”™è¯¯ï¼Œæ­»å¾ªç¯, è¿”å›error()çš„å‡½æ•°ï¼Œ 1234567891011function err():never{ throw new Error()}function fail():never{ return error('error')}function fn():never{ while (true){}} object(å¯¹è±¡)objectè¡¨ç¤ºéåŸå§‹ç±»å‹ã€‚ 123456789let obj:object = { number: 12}obj.number = 13; // error ä¸èƒ½ä¿®æ”¹let obj:{x:number, y:string} = { x: 1, y: 'abc'}obj.x = 2; // ok è”åˆç±»å‹å¯¹ä¸€äº›å€¼å¯ä»¥æ˜¯å¤šç§ç±»å‹çš„å˜é‡ï¼Œéœ€è¦ä½¿ç”¨è”åˆç±»å‹ã€‚ 12345678910111213141516171819// åŸºæœ¬ç±»å‹å˜é‡let foo: number | string | boolean;foo = 123;foo = 'abc';foo = false;// å‡½æ•°function fn(value: string | number):void { // ...}fn(1);fn('abc');// æ³›å‹å’Œæ•°ç»„let arr:(number|string)[] = [1,'string'];let arr: Array&lt;number|string|boolean&gt;;arr = [1, 1, boolean, 'abc']; ç±»å‹åˆ«åç±»å‹åˆ«åæ˜¯ç»™ä¸€ç»„æˆ–ä¸€ä¸ªç±»å‹èµ·ä¸€ä¸ªåç§°ã€‚ä»–åªæ˜¯å¼•ç”¨äº†åˆ«çš„ç±»å‹ï¼Œæœ¬èº«ä¸ä¼šåˆ›å»ºä¸€ä¸ªç±»å‹ã€‚ 1234type TypeName = number | string | boolean;let foo: TypeName = 123;let foo: TypeName = 'abc';let foo: boolean = false; ç±»å‹æ–­è¨€å½“ä¸€ä¸ªå˜é‡å¯ä»¥æ˜¯å¤šä¸ªç±»å‹çš„æ—¶å€™ã€‚ä½ å·²ç»æ˜ç¡®çŸ¥é“è¿™ä¸ªå˜é‡çš„å€¼æ˜¯æŸä¸€ç§ç±»å‹ï¼Œä½¿ç”¨è¿™ä¸ªç±»å‹ä¸Šçš„æŸä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šå¼•å‘tsæŠ¥é”™ã€‚ 1234let str1: string | number = &quot;123&quot;;// let len: number = str1.length; // error let len: number = (str1 as string).length; // æ–¹æ³•1 let len: number = (&lt;string&gt;str1).length // æ–¹æ³•2 ä¸èƒ½å†jsx ä¸­ä½¿ç”¨","link":"/blog/2019/09/17/TypeScript%E5%9F%BA%E7%A1%80%E7%B1%BB%E5%9E%8B-md/"},{"title":"mongodbæŸ¥è¯¢","text":"find find ç®€ä»‹ Mongodb ä½¿ç”¨findè¿›è¡ŒæŸ¥è¯¢ã€‚findæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æŒ‡å®šæŸ¥è¯¢æ¡ä»¶ã€‚é»˜è®¤æ˜¯ {}ã€‚ 12// ä¸æŒ‡å®šä»»ä½•æ¡ä»¶ï¼ŒæŸ¥è¯¢æ‰€æœ‰db.collections.find(); æŒ‡å®šè¿”å›çš„å€¼ findçš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯æŒ‡å®šéœ€è¦è¿”å›å“ªäº›å­—æ®µï¼Œè¿™æ ·é¿å…å°†æ‰€æœ‰çš„å­—æ®µè¿”å›ï¼Œå¯ä»¥èŠ‚çœä¼ è¾“çš„æ•°æ®é‡ï¼Œä¹Ÿå¯ä»¥èŠ‚çœå®¢æˆ·ç«¯è§£ç æ–‡æ¡£çš„æ—¶é—´å’Œå†…å­˜æ¶ˆè€—ã€‚æŒ‡å®šå­—æ®µçš„å€¼ 1 ä¸ºåŒ…å«ï¼Œ 0 ä¸ºæ’é™¤ã€‚é»˜è®¤æƒ…å†µä¸‹ _idæ˜¯æ€»æ˜¯ä¼šè¿”å›çš„ï¼Œåªæœ‰å½“è®¾ç½®ä¸º 0 æ‰ä¸ä¼šè¿”å›ã€‚æŒ‡å®šçš„å­—æ®µä¸­ä¸èƒ½åŒæ—¶åˆåŒ…å«å’Œæ’é™¤ã€‚ æ ¼å¼ 1db.collection.find(&lt;æŸ¥è¯¢æ¡ä»¶&gt;, &lt;éœ€è¦è¿”å›çš„å­—æ®µ&gt;) 12// è¿”å›çš„æ–‡æ¡£ä¸­åªåŒ…å« `name` ã€`email`å’Œ`_id`ã€‚db.users.find({ name: &quot;A&quot; }, { name: 1, email: 1 }); 12// è¿”å›æ–‡æ¡£ä¸­é™¤ `name`å­—æ®µå¤–æ‰€æœ‰çš„å­—æ®µã€‚db.users.find({ name: &quot;A&quot; }, { name: 0 }); 12// ä¸‹é¢çš„æŸ¥è¯¢å‡ºé”™**`Error`**db.users.find({ name: &quot;A&quot; }, { name: 1, email: 0 }); æŸ¥è¯¢æ¡ä»¶ æŸ¥è¯¢æ¡ä»¶ $ltã€$gtã€$lteã€$gteæ˜¯æ¯”è¾ƒæ“ä½œç¬¦ï¼Œå¯ä»¥å•ç‹¬ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ç»„åˆä½¿ç”¨æŸ¥è¯¢ä¸€ä¸ªèŒƒå›´çš„å€¼ã€‚å¯ä»¥æ¯”è¾ƒæ•°å­—å‹ã€æ—¶é—´å‹çš„å€¼ã€‚ 12// æŸ¥è¯¢ 18~30å²ï¼ˆå«ï¼‰çš„ç”¨æˆ·db.users.find({ age: { $gte: 18, $lte: 30 } }); 12// æŸ¥æ‰¾2007å¹´1æœˆ1æ—¥ä¹‹å‰æ³¨å†Œçš„ç”¨æˆ·ã€‚db.users.find({ registered: { $lt: new Date(&quot;01/01/2007&quot;) } }); $neæ˜¯ä¸ç­‰æ“ä½œç¬¦ã€‚å½“æŸ¥è¯¢æ¡ä»¶éœ€è¦æ­£åˆ™å»åŒ¹é…çš„æ—¶å€™ï¼Œä½¿ç”¨$neä¼šå‡ºé”™ã€‚æ­£åˆ™ç±»å‹çš„å¯ä»¥ä½¿ç”¨ $notæ“ä½œç¬¦ã€‚ 12// æŸ¥æ‰¾ `name!=A` çš„ç”¨æˆ·ã€‚db.users.find({ name: { $ne: &quot;A&quot; } }); 123// ä¸‹é¢æŸ¥è¯¢`name`å­—æ®µä¸ä»¥`A`å¼€å¤´çš„ç”¨æˆ·ï¼ŒæŠ¥é”™äº†ã€‚// Error `Can't have regex as arg to $ne.`db.users.find({ name: { $ne: /^A/ } }); OR æŸ¥è¯¢ æœ‰ä¸¤ç§æ–¹å¼è¿›è¡Œ OR æŸ¥è¯¢ã€‚ä¸€ç§æ˜¯ä½¿ç”¨$inç”¨æ¥æŸ¥è¯¢ä¸€ä¸ªé”®çš„å¤šä¸ªå€¼ï¼Œä¸€ç§æ˜¯ä½¿ç”¨$or å¯ä»¥åœ¨å¤šä¸ªé”®ä¸­æŸ¥è¯¢ä»»æ„ç»™å®šçš„å€¼ã€‚å¦‚æœéœ€è¦å¯¹$inçš„åŒ¹é…æ¡ä»¶åå–åå¯ä»¥ä½¿ç”¨$ninã€‚ 12// æŸ¥è¯¢ `status`å­—æ®µçš„å€¼æ˜¯ `1`|`2`|`3`çš„ç”¨æˆ·db.users.find({ status: { $in: [1, 2, 3] } }); 12// æŸ¥è¯¢`status`å­—æ®µçš„ä¸æ˜¯ `1`|`2`|`3`çš„ç”¨æˆ·db.users.find({ status: { $nin: [1, 2, 3] } }); 12// æŸ¥è¯¢ `status`å­—æ®µæ˜¯`1` æˆ–è€… `age`å­—æ®µå¤§äº`18`çš„ç”¨æˆ·db.users.find({ $or: [{ status: 1 }, { age: { $gt: 18 } }] }); $not $notæ“ä½œç¬¦æ˜¯åŒ¹é…é‚£äº›ä¸ç¬¦åˆæ¡ä»¶çš„æ–‡æ¡£ã€‚ç›¸å¯¹$ne ï¼Œ$notå¯ä»¥ç»“åˆæ­£åˆ™è¡¨è¾¾å¼ä¸€èµ·ä½¿ç”¨ã€‚ 123456789// æŸ¥è¯¢`name`å­—æ®µä¸æ˜¯ A çš„æ–‡æ¡£db.users.find({ name: { $not: &quot;A&quot; } });// æŸ¥è¯¢`age`å­—æ®µä¸å°äº1çš„æ–‡æ¡£db.users.find({ age: { $not: { $lt: 1 } } });// ç»“åˆæ­£åˆ™è¡¨è¾¾å¼æŸ¥è¯¢// æŸ¥è¯¢ `name`å­—æ®µä¸ä»¥å­—ç¬¦ä¸² a å¼€å¤´çš„db.users.find({ name: { $not: /^a/i } }); æ¡ä»¶è¯­å¥ æŸ¥è¯¢æ“ä½œç¬¦ä¸€èˆ¬æ˜¯å†…å±‚æ–‡æ¡£çš„é”®ã€‚æ›´æ–°æ“ä½œç¬¦åˆ™æ˜¯å¤–å±‚æ–‡æ¡£çš„é”®ã€‚ ç‰¹å®šç±»å‹æŸ¥è¯¢ null nullç±»å‹å¯ä»¥åŒ¹é…è‡ªèº«ï¼Œè¿˜ä¼šåŒ¹é…é‚£äº›æ²¡æœ‰è¿™ä¸ªé”®çš„æ–‡æ¡£ã€‚å¦‚æœè¦æ’é™¤æ‰æ²¡æœ‰è¿™ä¸ªé”®çš„æ–‡æ¡£ éœ€è¦ç»“åˆ$existsè¿™ä¸ªæ“ä½œç¬¦ã€‚ 12345// ä¸‹é¢è¿™æ ·ä¼šæŸ¥è¯¢å‡º å­—æ®µ x ä¸º null å’Œé‚£äº›æ²¡æœ‰ x å­—æ®µçš„æ–‡æ¡£db.users.find({ x: null });// ä¸‹é¢åªä¼šæŸ¥è¯¢å‡º å­—æ®µ x ä¸º nulldb.users.find({ x: { $in: [null], $exists: true } }); æ­£åˆ™è¡¨è¾¾å¼ æ­£åˆ™è¡¨è¾¾å¼å¯ä»¥çµæ´»æœ‰æ•ˆçš„åŒ¹é…å­—ç¬¦ä¸²ã€‚åƒå¯¹ä¸€ä¸ªå­—æ®µçš„æ¨¡ç³ŠæŸ¥è¯¢ï¼Œå¿½ç•¥å¤§å°å†™ç­‰å¾…éå¸¸æœ‰ç”¨ã€‚æ­£åˆ™è¡¨è¾¾å¼ä¹Ÿå¯ä»¥åŒ¹é…åˆ°è‡ªèº«ï¼Œå¦‚æœå­—æ®µä¸­çš„å€¼å°±æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œä¹Ÿèƒ½æ­£ç¡®åŒ¹é…ã€‚ 12345// æŸ¥è¯¢å­—æ®µ name ä¸­åŒ…å« (a|A) çš„æ–‡æ¡£db.users.find({ name: /a/i });// æŸ¥è¯¢å­—æ®µ name ä¸­åŒ…å« (a|A) å¼€å¤´çš„æ–‡æ¡£db.users.find({ name: /^a/i }); æŸ¥è¯¢æ•°ç»„ å•ä¸ªå…ƒç´ åŒ¹é…æ•°ç»„ 123// å‡è®¾ fruit çš„å€¼ä¸€ä¸ªæ•°ç»„// ä¸‹é¢çš„åŒ¹é…ä¼šåŒ¹é…åˆ° fruit æ•°ç»„ä¸­åŒ…å« apple ä¸€é¡¹çš„æ–‡æ¡£db.foods.find({ fruit: &quot;apple&quot; }); å¤šä¸ªå…ƒç´ åŒ¹é…æ•°ç»„ 123// å‡è®¾ fruit çš„å€¼ä¸€ä¸ªæ•°ç»„// ä¸‹é¢çš„åŒ¹é…ä¼šåŒ¹é…åˆ° fruit æ•°ç»„ä¸­åŒ…å« apple å’Œ banana çš„æ–‡æ¡£db.foods.find({ fruit: { $all: [&quot;apple&quot;, &quot;banana&quot;] } }); æ•°ç»„ç²¾ç¡®åŒ¹é… æ•°ç»„çš„ç²¾ç¡®åŒ¹é…å¿…é¡» æŸ¥è¯¢æ¡ä»¶ å’Œ æ–‡æ¡£ä¸­çš„å€¼ä¸ªæ•°å’Œé¡ºåºéƒ½å¿…é¡»ä¿æŒä¸€è‡´ã€‚è¦æŸ¥è¯¢æ•°ç»„ä¸­ç‰¹å®šä½ç½®çš„å…ƒç´ ï¼Œå¯åŠ ä¸Šæ•°ç»„ä¸‹æ ‡è¿›è¡ŒæŸ¥è¯¢ã€‚ 1234567// å‡è®¾ fruit çš„å€¼ä¸€ä¸ªæ•°ç»„// ä¸‹é¢åªä¼šåŒ¹é…å­—æ®µ fruit ä¸º [&quot;apple&quot;, &quot;banana&quot;]çš„æ–‡æ¡£db.foods.find({ fruit: [&quot;apple&quot;, &quot;banana&quot;] });// åŒ¹é…æ•°ç»„ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ çš„å€¼// ä¸‹é¢ä¼šåŒ¹é…åˆ° fruit å­—æ®µä¸­ç¬¬ä¸€ä¸ªå…ƒç´ çš„å€¼æ˜¯ apple çš„æ–‡æ¡£ã€‚db.foods.find({ &quot;fruit.0&quot;: &quot;apple&quot; }); $size $size å¯¹æŸ¥è¯¢å­—æ®µæ•°ç»„é•¿åº¦å¾ˆæœ‰æ•ˆã€‚åƒæŸ¥è¯¢æŸä¸ªå­—æ®µçš„æ•°ç»„å€¼åªæœ‰æŒ‡å®šçš„ä¸ªæ•°çš„æ–‡æ¡£ã€‚æ³¨æ„ï¼š $size ä¸èƒ½ä¸å…¶ä»–æŸ¥è¯¢æ¡ä»¶ç»„åˆä½¿ç”¨ã€‚ 123// å‡è®¾ fruit çš„å€¼ä¸€ä¸ªæ•°ç»„// æŸ¥è¯¢å­—æ®µ fruit çš„ä¸ªæ•°ä¸º 2 ä¸ªçš„æ–‡æ¡£db.foods.find({ fruit: { $size: 2 } }); 5) $slice $sliceæ“ä½œç¬¦å¯ä»¥è¿”å›æŸä¸ªé”®åŒ¹é…æ•°ç»„å…ƒç´ çš„ä¸€ä¸ªå­é›†ã€‚æ”¾åœ¨ findçš„ç¬¬äºŒä¸ªå‚æ•°ä¸­ã€‚è¿™ä¸ªæ“ä½œç¬¦ä¸ä¼šå½±å“æ–‡æ¡£å…¶ä»–é”®çš„è¿”å›ã€‚å¦‚æœæŒ‡å®šè¿”å›çš„é”®ï¼Œéœ€è¦æ˜¾ç¤ºå£°æ˜ã€‚ 123456789// è¿”å›æŸä¸€ä¸ªåšå®¢çš„å‰ 10 æ¡è¯„è®ºdb.find({ _id: ObjectId(x) }, { comment: { $slice: 10 } });// è¿”å›æŸä¸€ä¸ªåšå®¢çš„æœ€å 10 æ¡è¯„è®ºdb.find({ _id: ObjectId(x) }, { comment: { $slice: -10 } });// è¿”å›æŸä¸€ä¸ªåšå®¢çš„ä¸­è¯„è®º// è·³è¿‡å‰ 10 æ¡è¯„è®ºåï¼Œå–10æ¡db.find({ _id: ObjectId(x) }, { comment: { $slice: [10, 10] } }); $elemMatch å¯¹æ•°ç»„ä¸­æ¯ä¸€ä¸ªå…ƒç´ å’Œä¼ å…¥çš„æ‰€æœ‰æŸ¥è¯¢æ¡ä»¶è¿›è¡Œæ¯”è¾ƒã€‚ 1234// å‡è®¾ x çš„å€¼æ˜¯ä¸€ä¸ªæ•°ç»„// ä¼šå¯¹å­—æ®µ x è¿›è¡Œå¾ªç¯ï¼Œä¾æ¬¡å’Œ $elemMatch ä¸­çš„æ¡ä»¶è¿›è¡ŒåŒ¹é…// åªæœ‰å…ƒç´  å¤§äº10 å¹¶ä¸”å°äº20 æ‰ä¼šè¢«å‘½ä¸­db.tests.find({ x: { $elemMatch: { $gt: 10, $lt: 20 } } }); æŸ¥è¯¢å†…åµŒæ–‡æ¡£ æŸ¥è¯¢å†…åµŒæ–‡æ¡£æœ‰ä¸¤ç§æ–¹å¼ï¼š 1. æŸ¥è¯¢æ•´ä¸ªæ–‡æ¡£ï¼Œ 2.é’ˆå¯¹ key/value è¿›è¡ŒæŸ¥è¯¢ã€‚ ç²¾ç¡®æ“ä½œ å’Œ æ•°ç»„çš„ç²¾ç¡®æŸ¥æ‰¾ä¸€æ ·ã€‚ å†…åµŒæ–‡æ¡£çš„ å­—æ®µä¸ªæ•°ã€å­—æ®µé¡ºåºã€å­—æ®µåç§°éƒ½éœ€è¦ä¸€è‡´ã€‚ key/value æŸ¥æ‰¾ Key/value æŸ¥æ‰¾ä½¿ç”¨ç‚¹è¡¨ç¤ºæ³•ã€‚å½“ä¸¤ä¸ªæŸ¥è¯¢æ¡ä»¶ä½¿ç”¨äº†ç‚¹è¡¨ç¤ºæ³•ï¼Œä»–ä»¬çš„å…³ç³»æ˜¯ or çš„å…³ç³»ã€‚å¦‚æœéœ€è¦å¯¹ä¸¤ä¸ªæ¡ä»¶ä½¿ç”¨ andå…³ç³»ï¼Œå¯ä»¥ç»“åˆ $elemMatchæ“ä½œç¬¦ä½¿ç”¨ã€‚ 123456789101112131415// å‡è®¾éœ€è¦æŸ¥è¯¢ æœ‰ Joe å‘è¡¨çš„ 5 åˆ†ä»¥ä¸Šçš„è¯„è®º// ä¸‹é¢çš„æŸ¥è¯¢æ˜¯å¯èƒ½å¤±è´¥çš„ï¼Œå¦‚æœå†…åµŒæ–‡æ¡£åªæœ‰è¿™ä¸¤ä¸ªå­—æ®µçš„æ—¶å€™æ˜¯OKï¼Œ// å¦‚æœå†…åµŒæ–‡æ¡£ä¸­æœ‰é¢å¤–çš„å­—æ®µï¼Œå°±ä¼šå¤±è´¥ã€‚// ä¸‹é¢çš„æŸ¥è¯¢æ˜¯ç²¾ç¡®åŒ¹é…db.blogs.find({ comments: { author: &quot;joe&quot;, score: { $gte: 5 } } });// ä¸‹é¢çš„æŸ¥è¯¢ä¼šå¤±è´¥// ä¸‹é¢çš„æŸ¥è¯¢ä¼šåŒ¹é…åˆ° è¯„è®ºä¸­ author=joe æˆ–è€… score &gt;= 5 çš„æ–‡æ¡£ã€‚db.blogs.find({ &quot;comments.author&quot;: &quot;joe&quot;, &quot;comments.score&quot;: { $gte: 5 } });// å¯ä»¥ä½¿ç”¨ $elemMatchdb.blogs.find({ comments: { $elemMatch: { author: &quot;joe&quot;, score: { $gte: 5 } } }}); $where æŸ¥è¯¢$whereå¯ä»¥åœ¨æŸ¥è¯¢ä¸­æŒ‡å®šä»»æ„çš„ JavaScriptã€‚ä¸ºäº†å®‰å…¨å’Œæ€§èƒ½è€ƒè™‘ï¼Œåº”å°½å¯èƒ½é¿å…ä½¿ç”¨ã€‚ 123456db.foo.find({ $where: function() { // æŸ¥è¯¢é€»è¾‘ // è¿”å› true æ–‡æ¡£å°±ä½œä¸ºç»“æœé›†çš„ä¸€éƒ¨åˆ†è¿”å›ï¼Œè¿”å›false å°±ä¸è¿”å› }}); æ¸¸æ ‡ limitã€skipã€sort limitåœ¨findåä½¿ç”¨æ¥é™åˆ¶ç»“æœæ•°é‡ï¼Œskipå’Œlimitç»“åˆç”¨äºåˆ†é¡µæŸ¥è¯¢ï¼ŒæŒ‡å®šè·³è¿‡æŒ‡å®šæ¡æ•°ã€‚sortç”¨äºæ’åºï¼Œ1 ä¸ºå‡åºï¼Œ-1 ä½é™åºã€‚ 123456// ä¸‹é¢çš„æŸ¥è¯¢è·³è¿‡å‰10æ¡ï¼Œé€‰æ‹©10,ä»¥ age å‡åºæ’åºã€‚db.users .find() .skip(10) .limit(10) .sort({ age: 1 }); å‚è€ƒmongodb å®˜æ–¹æ–‡æ¡£ MongoDB æƒå¨æŒ‡å—ç¬¬äºŒç‰ˆä¹¦ç±","link":"/blog/2019/11/12/mongodb%E6%9F%A5%E8%AF%A2/"},{"title":"ä½¿ç”¨Dockæ­å»ºSentryæœåŠ¡","text":"æ­å»ºç¯å¢ƒ CentOS 7.5 64 ä½ docker: 18.09.6 docker-compose: 1.24.0 sentry: sentry 9.1-onbuild æ­å»ºæ­¥éª¤ å®‰è£… dockerã€docker-composeã€git æ‰§è¡Œ systemctl start docker å¯åŠ¨ dockerã€‚ 1$ systemctl start docker âš¡ï¸: å¯æ‰§è¡Œ systemctl enable docker å°†å¯åŠ¨ docker åŠ å…¥å¼€æœºè‡ªå¯ 1$ systemctl enable docker å…‹éš† sentryåˆ°æœ¬åœ°ã€‚git clone https://github.com/getsentry/onpremise.gitã€‚ 1$ git clone https://github.com/getsentry/onpremise.git æ‰§è¡Œ cd onpremise è¿›å…¥ onpremise æ–‡ä»¶å¤¹ã€‚ æ‰§è¡Œ docker volume create --name=sentry-data &amp;&amp; docker volume create --name=sentry-postgres 1$ docker volume create --name=sentry-data &amp;&amp; docker volume create --name=sentry-postgres âš¡ï¸: ä½¿ç”¨ docker volume åˆ›å»ºæœ¬åœ°æ•°æ®åº“å’Œ sentry å·ã€‚ æ‰§è¡Œ cp -n .env.example .env åˆ›å»º .env æ–‡ä»¶ã€‚ 1$ cp -n .env.example .env æ‰§è¡Œ docker-compose build æ„å»ºå¹¶æ ‡è®° docker æœåŠ¡ã€‚ 1$ docker-compose build æ‰§è¡Œ docker-compose run --rm web config generate-secret-key - ç”Ÿæˆå¯†é’¥ã€‚å°†å®ƒæ·»åŠ åˆ° .env ä½œä¸º SENTRY_SECRET_KEYçš„å€¼ï¼Œè¿˜è¦å°†å…¶æ·»åŠ åˆ° docker-compose.ymlä¸­ã€‚ 1$ docker-compose run --rm web config generate-secret-key æ‰§è¡Œ docker-compose run --rm web upgrade - æ„å»ºæ•°æ®åº“ã€‚ 1$ docker-compose run --rm web upgrade âš¡ï¸: å®˜æ–¹æ–‡æ¡£ è¯´è¿™é‡Œä¼š ä½¿ç”¨äº¤äº’å¼æç¤ºåˆ›å»ºç”¨æˆ·å¸æˆ· ã€‚åœ¨å®é™…æ“ä½œä¸­å´æ²¡æœ‰æç¤ºã€‚::å¦‚æœæ²¡æœ‰æç¤ºéœ€è¦æ‰§è¡Œç¬¬ 10 æ­¥::ã€‚ æ‰§è¡Œ docker exec -it onpremise_postgres_1 bash è¿›å…¥ docker å®¹å™¨ æ‰§è¡Œ postgres bash å‘½ä»¤æŸ¥çœ‹æ˜¯å¦æœ‰æ•°æ®ã€‚ 1$ docker exec -it onpremise_postgres_1 bash æ‰§è¡Œ psql -h 127.0.0.1 -d postgres -U postgres è¿›å…¥ postgres æ•°æ®åº“ 1$ psql -h 127.0.0.1 -d postgres -U postgres æ‰§è¡Œ select * from sentry_project; æŸ¥çœ‹ sentry_project è¡¨æ˜¯å¦æœ‰æ•°æ®ã€‚ 1$ select * from sentry_project; æ‰§è¡Œ select * from sentry_organization; æŸ¥çœ‹ sentry_organization è¡¨æ˜¯å¦æœ‰æ•°æ®ã€‚ 1$ select * from sentry_organization; æ‰§è¡Œ ctrl + d é€€å‡º shellã€‚ å¦‚æœæ²¡æœ‰æ•°æ®éœ€è¦æ·»åŠ ï¼Œ æ‰§è¡Œ docker-compose run --rm web shell è¿›å…¥ sentry çš„ web çš„ shell é‡Œé¢ã€‚åˆå§‹åŒ–æ•°æ® 1$ docker-compose run --rm web shell æ‰§è¡Œ from sentry.models import Projectã€‚ 1$ from sentry.models import Project æ‰§è¡Œ from sentry.receivers.core import create_default_projectsã€‚ 1$ from sentry.receivers.core import create_default_projects æ‰§è¡Œ create_default_projects([Project])ã€‚ 1$ create_default_projects([Project]) æ‰§è¡Œ ctrl + d é€€å‡ºã€‚ æ‰§è¡Œ docker-compose run --rm web createuser åˆ›å»ºç”¨æˆ·ã€‚ 1docker-compose run --rm web createuser æ‰§è¡Œ docker-compose up -d - æ„å»ºå¯åŠ¨å®¹å™¨ã€‚ åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ [ip]:9000ã€‚å¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œå°±åº”è¯¥èƒ½çœ‹åˆ°äº†ã€‚ å®‰è£…ç¢°åˆ°çš„é—®é¢˜ ğŸ’¥ åœ¨æ‰§è¡Œ docker-compose run --rm web upgrade çš„æ—¶å€™ã€‚å¯èƒ½ä¼šå‡ºç°æ²¡æœ‰æ‰§è¡Œå®Œå°±é€€å‡ºäº†ç»ˆç«¯ã€‚ ğŸ”¨ è§£å†³æ–¹æ¡ˆ: éœ€è¦é‡æ–°æ‰§è¡Œä¸Šé¢çš„å‘½ä»¤ ğŸ’¥ ç™»å½•åˆ°é¡¹ç›®åç‚¹å‡» Create a sample event æµ‹è¯•æ—¶ï¼Œ ä¼šå‘ç°æ˜¯å¤±è´¥çš„ï¼Œè€Œä¸”è¿™ä¸ªæ—¶å€™åœ¨é¡¹ç›®ä¸­äº§ç”Ÿçš„é”™è¯¯ä¸ä¼šåœ¨è¿™ä¸ª Issues åˆ—è¡¨ä¸­å±•ç¤ºã€‚ ğŸ”¨ è§£å†³æ–¹æ¡ˆ: å‚è€ƒï¼šWaiting for eventsâ€¦ Our error robot is waiting to devour receive your first event - #sentry æ‰§è¡Œ docker exec -it onpremise_postgres_1 bash è¿›å…¥ docker å®¹å™¨ æ‰§è¡Œ postgres bash å‘½ä»¤æŸ¥çœ‹æ˜¯å¦æœ‰æ•°æ®ã€‚ 1$ docker exec -it onpremise_postgres_1 bash æ‰§è¡Œ psql -h 127.0.0.1 -d postgres -U postgres è¿›å…¥ postgres æ•°æ®åº“ 1$ psql -h 127.0.0.1 -d postgres -U postgres æ‰§è¡Œä¸‹é¢ SQL è¯­å¥åã€‚åœ¨æµè§ˆå™¨ä¸­ç‚¹å‡» Create a sample event å°±å¥½äº†ï¼Œä¹Ÿæ­£å¸¸è®°å½• Issue äº†ã€‚ 123456789create or replace function sentry_increment_project_counter( project bigint, delta int) returns int as $$ declare new_val int;begin loop update sentry_projectcounter set value = value + delta where project_id = project returning value into new_val;if found then return new_val;end if;begin insert into sentry_projectcounter(project_id, value) values (project, delta) returning value into new_val;return new_val;exception when unique_violation then end;end loop;end $$ language plpgsql;","link":"/blog/2019/09/12/%E4%BD%BF%E7%94%A8Dock%E6%90%AD%E5%BB%BASentry%E6%9C%8D%E5%8A%A1/"}],"tags":[{"name":"Docker","slug":"Docker","link":"/blog/tags/Docker/"},{"name":"TypeScript","slug":"TypeScript","link":"/blog/tags/TypeScript/"},{"name":"å‰ç«¯","slug":"å‰ç«¯","link":"/blog/tags/%E5%89%8D%E7%AB%AF/"},{"name":"Mongodb","slug":"Mongodb","link":"/blog/tags/Mongodb/"},{"name":"æœåŠ¡ç›‘æ§","slug":"æœåŠ¡ç›‘æ§","link":"/blog/tags/%E6%9C%8D%E5%8A%A1%E7%9B%91%E6%8E%A7/"},{"name":"docker","slug":"docker","link":"/blog/tags/docker/"}],"categories":[]}